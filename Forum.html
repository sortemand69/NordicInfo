<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212; /* Dark background */
            color: #f0f0f0; /* Light text color */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Ensure full height */
            box-sizing: border-box; /* Include padding in height */
            transition: background-color 0.3s; /* Smooth background transition */
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #4a90e2; /* Accent color for header */
            font-size: 3rem; /* Increased header size */
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.7);
        }

        /* Container */
        .container {
            max-width: 800px;
            background: #1e1e1e; /* Dark grey background */
            border-radius: 15px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
            padding: 30px;
            margin-bottom: 20px;
            transition: transform 0.3s; /* Smooth scale transition */
        }

        .container:hover {
            transform: translateY(-5px); /* Lift effect on hover */
        }

        /* Form Styles */
        .post-form, .chat-form {
            margin-bottom: 20px;
            border: 1px solid #4a90e2; /* Accent border color */
            border-radius: 10px;
            padding: 20px;
            background: #2a2a2a; /* Darker background for form */
            transition: background 0.3s; /* Smooth background transition */
        }

        .post-form:hover, .chat-form:hover {
            background: #3b3b3b; /* Lighten on hover */
        }

        input[type="text"], textarea {
            width: calc(100% - 30px);
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #555; /* Dark border */
            border-radius: 6px;
            background: #333; /* Darker background for inputs */
            color: #fff; /* White text color */
            font-size: 1rem;
            transition: border 0.3s, background 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            border: 1px solid #4a90e2; /* Blue border on focus */
            outline: none;
            background: #444; /* Slightly lighter on focus */
        }

        button {
            padding: 12px 24px;
            background: #4a90e2; /* Button color */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s, transform 0.2s;
        }

        button:hover {
            background: #357ab8; /* Darker blue on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
        }

        /* Post and Message Styles */
        .posts, .chat {
            margin-top: 20px;
            animation: fadeIn 0.5s; /* Fade-in effect */
        }

        .post, .message {
            border: 1px solid #555; /* Dark border for posts */
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background: #2a2a2a; /* Darker background for posts/messages */
            transition: background 0.3s;
            position: relative; /* For positioning buttons */
            animation: slideIn 0.5s; /* Slide-in effect */
        }

        .post:hover, .message:hover {
            background: #3b3b3b; /* Lighten on hover */
        }

        .message {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Forum List Styles */
        .forum-list {
            list-style: none;
            padding: 0;
        }

        .forum-list li {
            padding: 12px;
            background: #3b3b3b; /* Background for forum items */
            margin: 5px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            position: relative; /* For positioning buttons */
            display: flex; /* Flexbox for positioning */
            justify-content: space-between; /* Space between text and buttons */
            align-items: center; /* Center items vertically */
        }

        .forum-list li:hover {
            background: #4a4a4a; /* Darker grey on hover */
            transform: scale(1.02);
        }

        /* Button Styles */
        .edit-button, .delete-button {
            background: #4caf50; /* Green for edit button */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 5px 10px;
        }

        .delete-button {
            background: #f44336; /* Red for delete button */
            margin-left: 10px; /* Space between buttons */
        }

        /* Footer Styles */
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #bbb; /* Lighter grey for footer text */
            animation: fadeIn 0.5s; /* Fade-in effect for footer */
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive Styles */
        @media (max-width: 600px) {
            h1 {
                font-size: 2.5rem; /* Adjust font size for smaller screens */
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Forum</h1>
        <div class="post-form">
            <h2>Create a Discussion Forum</h2>
            <input type="text" id="forum-title" placeholder="Forum Title" required>
            <button onclick="createForum()">Create Forum</button>
        </div>
        
        <div class="forum-list" id="forum-list">
            <h2>Available Forums</h2>
            <ul id="forums"></ul>
        </div>

        <div class="chat-form" id="chat-form" style="display:none;">
            <h2>Chat</h2>
            <input type="text" id="chat-message" placeholder="Type a message..." required>
            <button id="send-button" onclick="sendMessage()">Send</button>
        </div>
        
        <div class="chat" id="chat" style="display:none;">
            <h2>Chat Messages</h2>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Nordic Development. All rights reserved.</p>
    </footer>

    <script>
        // Check if the user is logged in
        if (!localStorage.getItem('loggedInUser')) {
            alert('You must be logged in to access the forum.');
            window.location.href = 'index.html'; // Redirect to login page if not logged in
        }

        const username = localStorage.getItem('loggedInUser');
        let lastMessageTime = 0;
        let currentForumTitle = ''; // Track the current forum title

        // Load existing forums from localStorage
        function loadForums() {
            const forumsContainer = document.getElementById('forums');
            forumsContainer.innerHTML = ''; // Clear existing forums
            const forums = JSON.parse(localStorage.getItem('forums')) || [];
            forums.forEach((forum, index) => {
                const forumElement = document.createElement('li');
                forumElement.textContent = forum.title;

                // Create Edit Button
                const editButton = document.createElement('button');
                editButton.className = 'edit-button';
                editButton.textContent = 'Edit';
                editButton.onclick = (event) => {
                    event.stopPropagation(); // Prevent joining forum when editing
                    editForum(index);
                };

                // Create Delete Button
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-button';
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = (event) => {
                    event.stopPropagation(); // Prevent joining forum when deleting
                    deleteForum(index);
                };

                // Append buttons to forum element
                forumElement.appendChild(editButton);
                forumElement.appendChild(deleteButton);
                forumElement.onclick = () => joinForum(forum.title); // Join forum on click

                forumsContainer.appendChild(forumElement);
            });
        }

        // Function to create a new forum
        function createForum() {
            const titleInput = document.getElementById('forum-title');
            const title = titleInput.value.trim();

            if (!title) {
                alert('Please enter a forum title.');
                return;
            }

            const forums = JSON.parse(localStorage.getItem('forums')) || [];
            forums.push({ title });
            localStorage.setItem('forums', JSON.stringify(forums));
            titleInput.value = ''; // Clear input field
            loadForums(); // Refresh the forum list
        }

        // Function to join a forum
        function joinForum(title) {
            currentForumTitle = title; // Set the current forum title
            document.getElementById('chat-form').style.display = 'block'; // Show chat form
            document.getElementById('chat').style.display = 'block'; // Show chat messages
            loadChatMessages(title); // Load existing messages
        }

        // Function to load chat messages
        function loadChatMessages(title) {
            const chatContainer = document.getElementById('chat');
            chatContainer.innerHTML = ''; // Clear existing messages
            const messages = JSON.parse(localStorage.getItem(`chat_${title}`)) || [];
            messages.forEach((message, index) => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.innerHTML = `<span><strong>${message.username}:</strong> ${message.text}</span>`;

                // Create Delete Button for message
                const deleteMsgButton = document.createElement('button');
                deleteMsgButton.className = 'delete-button';
                deleteMsgButton.textContent = 'Delete';
                deleteMsgButton.onclick = (event) => {
                    event.stopPropagation(); // Prevent joining forum when deleting message
                    deleteMessage(title, index); // Call delete message function
                };

                // Show delete button only for user's own messages
                if (message.username === username) {
                    messageElement.appendChild(deleteMsgButton); // Add delete button to message
                }

                chatContainer.appendChild(messageElement);
            });
        }

        // Function to send a message
        function sendMessage() {
            const messageInput = document.getElementById('chat-message');
            const messageText = messageInput.value.trim();

            if (!messageText) return; // Don't send empty messages

            const currentTime = new Date().getTime();

            if (currentTime - lastMessageTime < 3000) {
                alert('You can only send a message every 3 seconds.');
                return;
            }

            lastMessageTime = currentTime; // Update last message time

            if (!currentForumTitle) {
                alert('Please join a forum first.');
                return;
            }

            // Save message to localStorage
            const messages = JSON.parse(localStorage.getItem(`chat_${currentForumTitle}`)) || [];
            messages.push({ username, text: messageText });
            localStorage.setItem(`chat_${currentForumTitle}`, JSON.stringify(messages));
            messageInput.value = ''; // Clear input field

            loadChatMessages(currentForumTitle); // Reload messages
        }

        // Function to delete a message
        function deleteMessage(forumTitle, index) {
            const messages = JSON.parse(localStorage.getItem(`chat_${forumTitle}`)) || [];
            messages.splice(index, 1); // Remove the message
            localStorage.setItem(`chat_${forumTitle}`, JSON.stringify(messages));
            loadChatMessages(forumTitle); // Reload chat messages
        }

        // Function to edit a forum
        function editForum(index) {
            const forums = JSON.parse(localStorage.getItem('forums')) || [];
            const newTitle = prompt('Edit Forum Title:', forums[index].title);
            if (newTitle) {
                forums[index].title = newTitle;
                localStorage.setItem('forums', JSON.stringify(forums));
                loadForums();
            }
        }

        // Function to delete a forum
        function deleteForum(index) {
            const forums = JSON.parse(localStorage.getItem('forums')) || [];
            forums.splice(index, 1); // Remove the forum
            localStorage.setItem('forums', JSON.stringify(forums));
            loadForums();
            document.getElementById('chat').innerHTML = ''; // Clear chat messages
            document.getElementById('chat-form').style.display = 'none'; // Hide chat form
        }

        loadForums(); // Initial load of forums
    </script>
</body>
</html>
